<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="I help companies develop software products and make technical decisions. - Mocks, Stubs, Spies, Dummies and Fakes are types of test doubles that will help you to accomplish the goal of isolation. There are several libraries that provide tools to easily create these objects in your tests." property="og:description">
    <meta name="author" content="gaboesquivel.com">

    <title>Gabo Esquivel - Software Engineer and Consultant</title>

    

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <link href="/css/styles.css" rel="stylesheet">

    
    
    

</head>

<body class="blog">


  <header class="navbar custom-navbar navbar-fixed-top">
      <div class="container">
          <div class="row">
              <div class="col-md-3 col-sm-4 col-xs-12">
                  <div class="logo">
                     <div class="navbar-header">
                          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                              <span class="sr-only">Toggle navigation</span>
                              <span class="icon-bar"></span>
                              <span class="icon-bar"></span>
                              <span class="icon-bar"></span>
                          </button>
                      </div>
                      <a id="logo-gaboesquivel" class="theme-color" href="/"></a>
                  </div>
              </div>

              <div class="col-md-9 col-sm-8 col-xs-12">
                 <nav class="main-menu">
                  <div class="navbar-collapse collapse">
                      <ul class="nav navbar-nav"> 
                          <li><a class="smoth-scroll theme-color" href="/">Home</a></li>
                          <li><a class="smoth-scroll theme-color" id="about-link" href="/#about">About</a></li>
                          <li><a class="smoth-scroll theme-color" href="/#services">service</a></li>
                          <li><a class="smoth-scroll theme-color" href="/#projects">projects</a></li>
                          <li><a class="smoth-scroll theme-color" href="/bio/">bio</a></li>
                          <li><a class="smoth-scroll theme-color" href="/blog/">blog</a></li>
                          <li><a class="smoth-scroll theme-color" href="/contact/">contact</a></li>
                      </ul>
                  </div>
                  </nav>
              </div>
          </div>
      </div>
  </header>
  


<div class="blog">
  
  
  <header class="intro-header" style="background-image: url('/img/post-bg.jpg')">
  
    <div class="container">
      <div class="row">
         <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
           <div class="post-heading">
             <h1>Unit Testing: Mocks, Stubs and Spies</h1>
             <h2 class="subheading">What are they for?</h2>
           </div>
         </div>
      </div>
    </div>
  </header>

  
  <article>
      <div class="container">
          <div class="row">
              <div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1">
                <p>In unit testing isolation is key. The class/object/function you are testing is called the System Under Test (SUT) and the SUT often interacts with other part of the system, these parts are called Collaborators or Depedencies. When testing the simulation of the collaborators/dependencies and behaviors of these dependencies allows you to to test the units in isolation. Gerard Meszaros author of xUnit Test Patterns uses the term &ldquo;Test Double&rdquo; as the generic term for any kind of pretend object used in place of a real object for testing purposes. The name comes from the notion of a Stunt Double in movies.</p>

<p>Mocks, Stubs, Spies, Dummies and Fakes are types of test doubles that will help you to accomplish the goal of isolation. There are several libraries that provide tools to easily create these objects in your tests. Sinon.js is a javascript library that provides standalone test spies, stubs and mocks with no dependencies that work with any unit testing framework.

<strong>Dummies</strong></p>

<p>Dummy objects are passed around but never actually used. Usually they are just used to fill parameter lists. It is an object that simply implements an Interface, and does nothing else. It&rsquo;s not intended to be used in your tests and will have no effect on the behaviour, sometimes a null object could be sufficient. An example would be passing an object into a constructor that isn&rsquo;t used in the path you&rsquo;re taking, or a simple object to add to a collection.</p>

<pre><code class="javascript">
var TaskManager = function(){
    var taskList = [];

    return {
        addTask: function(task){
            taskList.push(task);
        },
        tasksCount: function(){
            return taskList.length;
        }
    }
}

// Test
var assert = require("assert")
describe('add task', function(){
    it('should keep track of the number of tasks', function(){
      var DummyTask = function(){ return {} };
      var taskManager = new TaskManager();

      taskManager.addTask(new DummyTask());
      taskManager.addTask(new DummyTask());

      assert.equal( taskManager.tasksCount(), 2 );

    })
})
</code></pre>

<p><strong>Spies</strong></p>

<p>A test spy is an object that records its interaction with other objects throughout the code base. When deciding if a test was successful based on the state of available objects alone is not sufficient, we can use test spies and make assertions on things such as the number of calls, arguments passed to specific functions, return values and more.</p>

<p>Test spies are useful to test both callbacks and how certain functions/methods are used throughout the system under test. The following simplified example shows how to use spies to test how a function handles a callback:</p>

<pre><code class="javascript">
"test should call subscribers on publish": function () {
    var callback = sinon.spy();
    PubSub.subscribe("message", callback)
    PubSub.publishSync("message");

    assertTrue(callback.called);
}
</code></pre>

<p><strong>Stubs</strong></p>

<p>Test stubs are fake objects with pre-programmed behavior ( Simulation of behaviour from other units ), Most of times they are simply returning fixed values. They are typically used for one of two reasons:</p>

<ul>
<li>To avoid some inconvenient interface - for instance to avoid making actual requests to a server from tests.<br /></li>
<li>To feed the system with known data, forcing a specific code path.<br /></li>
</ul>

<p>Javascript is flexible enough to accomplish this easily without any library</p>

<pre><code class="javascript">
"example of simple stub without any lib": function () {
    var task = { completed = true }
}
</code></pre>

<p><strong>Fakes</strong></p>

<p>Fake objects have working implementations, but usually take some shortcut which makes them not suitable for production (an in memory database is a good example). The simplest way to think of a Fake is as a step up from a Stub. This means not only does it return values, but it also works just as a real Collaborator would.</p>

<pre><code class="javascript">
var xhr, requests;

before(function  {
    xhr = sinon.useFakeXMLHttpRequest();
    requests = [];
    xhr.onCreate = function (req) { requests.push(req); };
});

after(function () {
    // we must clean up when tampering with globals.
    xhr.restore();
});

it("makes a GET request for todo items", function () {
    getTodos(42, sinon.spy());

    assert.equals(requests.length, 1);
    assert.match(requests[0].url, "/todo/42/items");
});
</code></pre>

<p><strong>Mocks</strong></p>

<p>When most people talk about Mocks what they are actually referring to are Test Doubles. A Test Double is simply another object that conforms to the interface of the required Collaborator, and can be passed in its place. There are very few classes that operate entirely in isolation. Usually they need other classes or objects in order to function, whether injected via the constructor or passed in as method parameters. These are known as Collaborators or Depencies.</p>

<p>References:</p>

<ul>
<li><a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks Aren&rsquo;t Stubs</a> by Martin Fowler<br /></li>
<li><a href="http://xunitpatterns.com/Test%20Double%20Patterns.html">XUnit Test Patterns: Test Double Patterns</a><br /></li>
</ul>
              </div>
          </div>
      </div>
  </article>
</div>




    <hr>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <ul class="list-inline text-center">
                
                  <li>
                    <a href="/contact">
                      <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                      </span>
                    </a>
                  </li>
                

                <li>
                  <a href="https://github.com/gaboesquivel" target="_blank">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>

                <li>
                  <a href="https://linkedin.com/in/gaboesquivel" target="_blank">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>

                <li>
                  <a href="https://twitter.com/gaboesquivel" target="_blank">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>

                <li>
                  <a href="https://medium.com/@gaboesquivel" target="_blank">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-medium fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>

                <li>
                  <a href="https://facebook.com/gaboesquiveldev" target="_blank">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>

              </ul>
            </div>
        </div>
    </div>
</footer>
<div class="footer">
  <div class="container">
    <div class="row wow zoomIn" data-wow-delay="0.4s">
      <div class="col-md-12 text-center">
        <p>&copy;2017 <strong>Gabo Esquivel</strong>. Software Engineer</p>
      </div>
    </div>
  </div>
</div>


    
    <script src="/js/bundle.js"></script>

    <script>
        window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
        ga('create','UA-33521499-1','auto');ga('send','pageview')
    </script>
    <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</body>

</html>

